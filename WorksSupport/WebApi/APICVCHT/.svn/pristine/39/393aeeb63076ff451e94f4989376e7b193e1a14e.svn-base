create or replace PROCEDURE WORKSSUPPORT_WFNX_V2_GETBY
/*
	CREATED BY	:	NGUYEN THI KIM NGAN
	DATE		:	02/06/2017
	DESCRIPTION	:	N?P DANH SACH BUOC XU LY KE TIEP TRONG CONG VIEC CAN HO TRO
*/ (
    V_OUT              OUT SYS_REFCURSOR,
    V_WORKSSUPPORTID   IN EO_WORKSSUPPORT.WORKSSUPPORTID%TYPE
)
    AS
BEGIN
    OPEN V_OUT FOR

    SELECT 
        NX.NEXTWORKSSUPPORTSTEPID,
        WF.WORKSSUPPORTSTEPNAME,
        (
                SELECT
                    EO_WORKSSUPPORTTYPE_WF_PERMIS.ISMUSTCHOOSEPROCESSUSER
                FROM
                    EO_WORKSSUPPORTTYPE_WF_PERMIS EO_WORKSSUPPORTTYPE_WF_PERMIS
                    INNER JOIN 
                        EO_WORKSSUPPORTTYPE_WFNXPERMIS EO_WORKSSUPPORTTYPE_WFNXPERMIS ON
                        EO_WORKSSUPPORTTYPE_WF_PERMIS.WORKSSUPPORTSTEPID = EO_WORKSSUPPORTTYPE_WFNXPERMIS.WORKSSUPPORTSTEPID
                    AND
                        EO_WORKSSUPPORTTYPE_WF_PERMIS.WORKSSUPPORTMEMBERROLEID = EO_WORKSSUPPORTTYPE_WFNXPERMIS.WORKSSUPPORTMEMBERROLEID
                WHERE
                    EO_WORKSSUPPORTTYPE_WF_PERMIS.WORKSSUPPORTSTEPID =
                    (
                        SELECT
                            CURRENTWORKSSUPPORTSTEPID
                        FROM
                            EO_WORKSSUPPORT
                        WHERE 
                            WORKSSUPPORTID = V_WORKSSUPPORTID
                    )                    
            ) AS ISMUSTCHOOSEPROCESSUSER
    FROM 
        EO_WORKSSUPPORTTYPE_WF_NX NX
    LEFT JOIN
        EO_WORKSSUPPORTTYPE_WORKFLOW WF
    ON
        NX.NEXTWORKSSUPPORTSTEPID = WF.WORKSSUPPORTSTEPID
    INNER JOIN
        EO_WORKSSUPPORT SP
    ON
        WF.WORKSSUPPORTTYPEID = SP.WORKSSUPPORTTYPEID
    WHERE 
        SP.WORKSSUPPORTID = V_WORKSSUPPORTID
    AND 
        NX.WORKSSUPPORTSTEPID = SP.CURRENTWORKSSUPPORTSTEPID
    ORDER BY
        WF.WORKSSUPPORTSTEPID ASC;
END;