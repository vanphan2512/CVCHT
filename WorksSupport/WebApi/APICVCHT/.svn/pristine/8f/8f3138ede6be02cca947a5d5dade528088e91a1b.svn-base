CREATE OR REPLACE PROCEDURE ERP.WORKSSUPPORTPRIORITY_V2_UPD
/*
	CREATED BY	:	NGUYEN THI KIM NGAN
	DATE		:	16/12/2015
	DESCRIPTION	:	CAP NHAT THÔNG TIN MUC DO XU LY
*/
(
   V_OUT OUT SYS_REFCURSOR,
	V_WORKSSUPPORTPRIORITYID IN EO_WORKSSUPPORTPRIORITY.WORKSSUPPORTPRIORITYID%TYPE,
	V_WORKSSUPPORTPRIORITYNAME IN EO_WORKSSUPPORTPRIORITY.WORKSSUPPORTPRIORITYNAME%TYPE,
  V_ICONURL IN EO_WORKSSUPPORTPRIORITY.ICONURL%TYPE,
	V_DESCRIPTION IN EO_WORKSSUPPORTPRIORITY.DESCRIPTION%TYPE,
	V_ORDERINDEX IN EO_WORKSSUPPORTPRIORITY.ORDERINDEX%TYPE,
	V_ISACTIVE IN EO_WORKSSUPPORTPRIORITY.ISACTIVE%TYPE,
	V_ISSYSTEM IN EO_WORKSSUPPORTPRIORITY.ISSYSTEM%TYPE,
  V_UPDATEDUSER IN EO_WORKSSUPPORTPRIORITY.UPDATEDUSER%TYPE,
  V_CERTIFICATESTRING IN EO_WORKSSUPPORTPRIORITY_LOG.CERTIFICATESTRING%TYPE,
	V_USERHOSTADDRESS IN EO_WORKSSUPPORTPRIORITY_LOG.USERHOSTADDRESS%TYPE,
	V_LOGINLOGID IN EO_WORKSSUPPORTPRIORITY_LOG.LOGINLOGID%TYPE
)
AS
BEGIN
  IF V_ICONURL = '' OR V_ICONURL IS NULL  THEN
       UPDATE EO_WORKSSUPPORTPRIORITY
	      SET
    		WORKSSUPPORTPRIORITYNAME	= V_WORKSSUPPORTPRIORITYNAME,
    		--ICONURL	= V_ICONURL,
        ORDERINDEX = V_ORDERINDEX,
    		DESCRIPTION	= V_DESCRIPTION,
    		ISACTIVE	= V_ISACTIVE,
    		ISSYSTEM	= V_ISSYSTEM,
    		UPDATEDDATE	= SYSDATE
    	WHERE
    		WORKSSUPPORTPRIORITYID = V_WORKSSUPPORTPRIORITYID;
    else
      UPDATE EO_WORKSSUPPORTPRIORITY
  	  SET
  		WORKSSUPPORTPRIORITYNAME	= V_WORKSSUPPORTPRIORITYNAME,
  		ICONURL	= V_ICONURL,
      ORDERINDEX = V_ORDERINDEX,
  		DESCRIPTION	= V_DESCRIPTION,
  		ISACTIVE	= V_ISACTIVE,
  		ISSYSTEM	= V_ISSYSTEM,
  		UPDATEDDATE	= SYSDATE
  	WHERE
  		WORKSSUPPORTPRIORITYID = V_WORKSSUPPORTPRIORITYID;
  END IF;

  INSERT
  INTO EO_WORKSSUPPORTPRIORITY_LOG
	(
		WORKSSUPPORTPRIORITYID,
		WORKSSUPPORTPRIORITYNAME,
		ICONURL,
		DESCRIPTION,
		ORDERINDEX,
		ISACTIVE,
		ISSYSTEM,
    UPDATEDUSER,
		UPDATEDDATE,
	  LOGTYPE,
		USERHOSTADDRESS,
		CERTIFICATESTRING,
		LOGINLOGID
	)
	VALUES
	(
		V_WORKSSUPPORTPRIORITYID,
		V_WORKSSUPPORTPRIORITYNAME,
		V_ICONURL,
		V_DESCRIPTION,
		V_ORDERINDEX,
		V_ISACTIVE,
		V_ISSYSTEM,
   	V_UPDATEDUSER,
		SYSDATE,
	  2,
		V_USERHOSTADDRESS,
		V_CERTIFICATESTRING,
		V_LOGINLOGID
	);
    OPEN V_OUT FOR 
    SELECT * 
      FROM EO_WORKSSUPPORTPRIORITY WHERE  workssupportpriorityid = V_WORKSSUPPORTPRIORITYID;
    RETURN;
END;
/