CREATE OR REPLACE PROCEDURE ERP.WORKSSUPPORT_V2_ADD
/*
	CREATED BY	:	NGUYEN THI KIM NGAN
	DATE		:	26/06/2017
	DESCRIPTION	:	THÊM THÔNG TIN CÔNG VI?C C?N H? TR? 
*/
(
  V_OUT OUT NUMBER,
	V_WORKSSUPPORTNAME IN EO_WORKSSUPPORT.WORKSSUPPORTNAME%TYPE,
	V_CONTENT IN NVARCHAR2,
  V_PERIODID IN EO_WORKSSUPPORT.PERIODID%TYPE,
  V_WORKSSUPPORTGROUPID IN EO_WORKSSUPPORT.WORKSSUPPORTGROUPID%TYPE,
	V_WORKSSUPPORTPRIORITYID IN EO_WORKSSUPPORT.WORKSSUPPORTPRIORITYID%TYPE,
	V_EXPECTEDCOMPLETEDDATE IN EO_WORKSSUPPORT.EXPECTEDCOMPLETEDDATE%TYPE,
	V_CREATEDUSER IN EO_WORKSSUPPORT.CREATEDUSER%TYPE,
	V_CERTIFICATESTRING IN EO_WORKSSUPPORT_LOG.CERTIFICATESTRING%TYPE,
	V_USERHOSTADDRESS IN EO_WORKSSUPPORT_LOG.USERHOSTADDRESS%TYPE,
	V_LOGINLOGID IN EO_WORKSSUPPORT_LOG.LOGINLOGID%TYPE
)
AS
  T_WORKSSUPPORTTYPEID NUMBER := 0;
  T_STATUSID NUMBER :=0;
BEGIN 
  SELECT PROJECT.WORKSSUPPORTTYPEID INTO T_WORKSSUPPORTTYPEID
    FROM EO_WORKSSUPPORTPROJECT PROJECT
    where EXISTS (SELECT 1 
                    FROM EO_WORKSSUPPORTGROUP WSGROUP
                    WHERE WSGROUP.WORKSSUPPORTPROJECTID = PROJECT.WORKSSUPPORTPROJECTID 
                    AND WSGROUP.WORKSSUPPORTGROUPID =V_WORKSSUPPORTGROUPID)
                  AND PROJECT.ISDELETED = 0;
 
  SELECT STATUS.WORKSSUPPORTSTATUSID INTO T_STATUSID
    FROM EO_WORKSSUPPORTSTATUS STATUS
    WHERE STATUS.ISDELETED = 0 AND STATUS.ISINITSTATUS = 1 
  AND ROWNUM = 1;
	INSERT
	INTO EO_WORKSSUPPORT
	(
		WORKSSUPPORTTYPEID,
		WORKSSUPPORTNAME,
		CONTENT,
    PERIODID,
		WORKSSUPPORTPRIORITYID,
    WORKSSUPPORTGROUPID,
    WORKSSUPPORTSTATUSID,
		EXPECTEDCOMPLETEDDATE,
		CREATEDUSER,
		CREATEDDATE
	)
	VALUES
	(
		T_WORKSSUPPORTTYPEID,
		V_WORKSSUPPORTNAME,
		V_CONTENT,
    V_PERIODID,
		V_WORKSSUPPORTPRIORITYID,
    V_WORKSSUPPORTGROUPID,
    T_STATUSID,
		V_EXPECTEDCOMPLETEDDATE,
		V_CREATEDUSER,
    SYSDATE
	) RETURNING WORKSSUPPORTID INTO V_OUT;
	INSERT
	INTO EO_WORKSSUPPORT_LOG
	(
		--WORKSSUPPORTID,
		WORKSSUPPORTTYPEID,
		WORKSSUPPORTNAME,
		CONTENT,
		WORKSSUPPORTSTATUSID,
		EXPECTEDCOMPLETEDDATE,
		UPDATEDUSER,
		UPDATEDDATE,
		LOGTYPE,
		USERHOSTADDRESS,
		CERTIFICATESTRING,
		LOGINLOGID
	)
	VALUES
	(
		--V_WORKSSUPPORTID,
		T_WORKSSUPPORTTYPEID,
		V_WORKSSUPPORTNAME,
		V_CONTENT,
    T_STATUSID,
		V_EXPECTEDCOMPLETEDDATE,
		V_CREATEDUSER,
		SYSDATE,
		1,
		V_USERHOSTADDRESS,
		V_CERTIFICATESTRING,
		V_LOGINLOGID
	)
   ;
END;
/