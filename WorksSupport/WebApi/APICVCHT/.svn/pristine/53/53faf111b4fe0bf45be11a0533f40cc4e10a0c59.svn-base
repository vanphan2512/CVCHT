create or replace PROCEDURE WORKSSUPPORT_V2_STEP_WF_PER
/*
	CREATED BY	:	TRUONG HOANG NHI
	DATE		:	01/08/2017
	DESCRIPTION	:	N?P QUYEN NHÓM CÔNG VI?C C?N H? TR? THEO VAI TRO THANH VIEN DU AN
*/
(       
    V_USERNAME IN EO_WORKSSUPPORTGROUP_MEMBER.MEMBERUSERNAME%TYPE,
    V_WORKSSUPPORTID IN EO_WORKSSUPPORT.WORKSSUPPORTID%TYPE,
    V_OUT OUT SYS_REFCURSOR
)
 AS  
  BEGIN
     OPEN V_OUT FOR
      SELECT
            WF_PERMIS.ISCANEDITCONTENT,
            WF_PERMIS.ISCANEDITSOLUTIONCONTENT,
            WF_PERMIS.ISCANADDATTACHMENT,
            WF_PERMIS.ISCANCOMMENT,
            WF_PERMIS.ISCANEDITEXPECTEDCOMPLETEDDATE,
            WF_PERMIS.ISCANCHANGEPROGRESS,
            WF_PERMIS.ISCANEDITQUALITY,
            WF_PERMIS.ISCANPROCESSWORKFLOW,
            WF_PERMIS.ISMUSTCHOOSEPROCESSUSER
        FROM 
            EO_WORKSSUPPORTTYPE_WF_PERMIS WF_PERMIS
        INNER JOIN 
            EO_WORKSSUPPORTGROUP_MEMBER MEMBERS
        ON 
            WF_PERMIS.WORKSSUPPORTMEMBERROLEID = MEMBERS.WORKSSUPPORTMEMBERROLEID 
        AND 
            MEMBERS.MEMBERUSERNAME = V_USERNAME
        AND 
            MEMBERS.WORKSSUPPORTGROUPID = 
            (
                SELECT
                    EO_WORKSSUPPORT.WORKSSUPPORTGROUPID
                FROM 
                    EO_WORKSSUPPORT
                WHERE 
                    WORKSSUPPORTID = V_WORKSSUPPORTID
            )
            AND
            WF_PERMIS.WORKSSUPPORTSTEPID = 
            (
                SELECT
                    EO_WORKSSUPPORT.CURRENTWORKSSUPPORTSTEPID
                FROM 
                    EO_WORKSSUPPORT
                WHERE 
                    WORKSSUPPORTID = V_WORKSSUPPORTID
            );           

  END;