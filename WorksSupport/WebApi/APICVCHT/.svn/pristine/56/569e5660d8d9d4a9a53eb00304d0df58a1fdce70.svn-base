-- Script was generated by Devart dbForge Studio for Oracle, Version 3.1.260.0
-- Product home page: http://www.devart.com/dbforge/oracle/studio
-- Script date 6/23/2017 1:02:35 PM
-- Server version: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production With the Partitioning, OLAP, Data Mining and Real Application Testing options
-- Client version: 

CREATE OR REPLACE PROCEDURE ERP.WORKSSUPORTPROJECT_V2_SRH
/*
	CREATED BY	:	Nguy?n Van Ph?n
	DATE		:	09/06/2017
	DESCRIPTION	:	N?P DANH SÁCH D? ÁN

*/
(
    V_OUT OUT SYS_REFCURSOR,
    V_KEYWORDS NVARCHAR2 DEFAULT NULL,
    V_ISDELETED EO_WORKSSUPPORTPROJECT.ISDELETED%TYPE DEFAULT 0,
    V_PAGEINDEX NUMBER DEFAULT -1,
    V_PAGESIZE NUMBER DEFAULT -1
) 
AS
BEGIN
   OPEN V_OUT FOR
   SELECT * 
   FROM(
	SELECT
	  EO_WORKSSUPPORTPROJECT.WORKSSUPPORTPROJECTID,
		EO_WORKSSUPPORTPROJECT.WORKSSUPPORTPROJECTNAME,
		EO_WORKSSUPPORTPROJECT.DESCRIPTION,
		EO_WORKSSUPPORTPROJECT.ORDERINDEX,
		EO_WORKSSUPPORTPROJECT.ISACTIVE,
		EO_WORKSSUPPORTPROJECT.ISSYSTEM,
		NVL2(EO_WORKSSUPPORTPROJECT.CREATEDUSER,	EO_WORKSSUPPORTPROJECT.CREATEDUSER ||'-'||CREATEDUSER.FULLNAME,'') CREATEDUSER,
		EO_WORKSSUPPORTPROJECT.CREATEDDATE,
		NVL2( EO_WORKSSUPPORTPROJECT.UPDATEDUSER,EO_WORKSSUPPORTPROJECT.UPDATEDUSER ||'-'||UPDATEDUSER.FULLNAME,'') UPDATEDUSER,
		EO_WORKSSUPPORTPROJECT.UPDATEDDATE,
		EO_WORKSSUPPORTPROJECT.ISDELETED,
		EO_WORKSSUPPORTPROJECT.DELETEDUSER,
		EO_WORKSSUPPORTPROJECT.DELETEDDATE,
    ROW_NUMBER() OVER (ORDER BY EO_WORKSSUPPORTPROJECT.ORDERINDEX ASC ,EO_WORKSSUPPORTPROJECT.CREATEDDATE DESC) STT,
    SUM(1) OVER()AS TOTALROWS
	FROM 
    EO_WORKSSUPPORTPROJECT
    LEFT  JOIN SYS_USER CREATEDUSER 
      ON CREATEDUSER.USERNAME = EO_WORKSSUPPORTPROJECT.CREATEDUSER
    LEFT  JOIN SYS_USER UPDATEDUSER 
      ON UPDATEDUSER.USERNAME = EO_WORKSSUPPORTPROJECT.UPDATEDUSER
	WHERE 
    EO_WORKSSUPPORTPROJECT.ISDELETED = V_ISDELETED
    AND (V_KEYWORDS IS NULL 
         OR EO_WORKSSUPPORTPROJECT.WORKSSUPPORTPROJECTID LIKE '%' || V_KEYWORDS || '%'
         OR UPPER ( EO_WORKSSUPPORTPROJECT.WORKSSUPPORTPROJECTNAME ) LIKE '%' ||UPPER ( V_KEYWORDS )|| '%')
  ORDER BY 
    EO_WORKSSUPPORTPROJECT.ORDERINDEX
  )
  WHERE
  V_PAGESIZE < 0 
  OR
  (STT > V_PAGEINDEX * V_PAGESIZE AND STT <= (V_PAGEINDEX + 1) * V_PAGESIZE);
END;
/