create or replace PROCEDURE WORKSSUPPORT_WFNX_V2_MEMBER
/*
	CREATED BY	:	NGUYEN THI KIM NGAN
	DATE		:	02/06/2017
	DESCRIPTION	:	N?P DANH SACH NGUOI THUC HIEN TRONG CONG VIEC CAN HO TRO
*/ (
    V_OUT                  OUT SYS_REFCURSOR,
    V_WORKSSUPPORTID       IN EO_WORKSSUPPORT.WORKSSUPPORTID%TYPE,
    V_WORKSSUPPORTSTEPID   IN EO_WORKSSUPPORT.WORKSSUPPORTID%TYPE
)
    AS
BEGIN
    OPEN V_OUT FOR
        SELECT
            US.USERNAME,
            US.FULLNAME,
            ME.WORKSSUPPORTMEMBERROLEID
--            (
--                SELECT
--                    EO_WORKSSUPPORTTYPE_WF_PERMIS.ISMUSTCHOOSEPROCESSUSER
--                FROM
--                    EO_WORKSSUPPORTTYPE_WF_PERMIS EO_WORKSSUPPORTTYPE_WF_PERMIS
--                    INNER JOIN 
--                        EO_WORKSSUPPORTTYPE_WFNXPERMIS EO_WORKSSUPPORTTYPE_WFNXPERMIS ON
--                        EO_WORKSSUPPORTTYPE_WF_PERMIS.WORKSSUPPORTSTEPID = EO_WORKSSUPPORTTYPE_WFNXPERMIS.WORKSSUPPORTSTEPID
--                    AND
--                        EO_WORKSSUPPORTTYPE_WF_PERMIS.WORKSSUPPORTMEMBERROLEID = EO_WORKSSUPPORTTYPE_WFNXPERMIS.WORKSSUPPORTMEMBERROLEID
--                WHERE
--                    EO_WORKSSUPPORTTYPE_WF_PERMIS.WORKSSUPPORTSTEPID = V_WORKSSUPPORTSTEPID
--            ) AS ISMUSTCHOOSEPROCESSUSER
        FROM
            SYS_USER US
            INNER JOIN EO_WORKSSUPPORTGROUP_MEMBER ME ON US.USERNAME = ME.MEMBERUSERNAME
            INNER JOIN EO_WORKSSUPPORTTYPE_WFNXPERMIS WF ON ME.WORKSSUPPORTMEMBERROLEID = WF.WORKSSUPPORTMEMBERROLEID
        WHERE
            ME.WORKSSUPPORTGROUPID = (
                SELECT
                    WORKSSUPPORTGROUPID
                FROM
                    EO_WORKSSUPPORT
                WHERE
                    WORKSSUPPORTID = V_WORKSSUPPORTID
            )
        AND
            WF.NEXTWORKSSUPPORTSTEPID = V_WORKSSUPPORTSTEPID;

END;